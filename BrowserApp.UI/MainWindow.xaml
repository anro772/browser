<Window x:Class="BrowserApp.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        xmlns:vm="clr-namespace:BrowserApp.UI.ViewModels"
        xmlns:views="clr-namespace:BrowserApp.UI.Views"
        mc:Ignorable="d"
        Title="{Binding PageTitle}"
        Height="1000"
        Width="1600"
        MinHeight="600"
        MinWidth="800"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Navigation Bar -->
        <Grid Grid.Row="0"
              Background="{DynamicResource ApplicationBackgroundBrush}"
              Margin="0,4,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Navigation Buttons -->
            <StackPanel Grid.Column="0"
                        Orientation="Horizontal"
                        Margin="8,4">
                <ui:Button Icon="{ui:SymbolIcon ArrowLeft24}"
                           ToolTip="Back (Alt+Left)"
                           Command="{Binding BackCommand}"
                           IsEnabled="{Binding CanGoBack}"
                           Appearance="Secondary"
                           Margin="2,0"/>
                <ui:Button Icon="{ui:SymbolIcon ArrowRight24}"
                           ToolTip="Forward (Alt+Right)"
                           Command="{Binding ForwardCommand}"
                           IsEnabled="{Binding CanGoForward}"
                           Appearance="Secondary"
                           Margin="2,0"/>
                <ui:Button Icon="{ui:SymbolIcon ArrowClockwise24}"
                           ToolTip="Refresh (F5)"
                           Command="{Binding RefreshCommand}"
                           Appearance="Secondary"
                           Margin="2,0"/>
                <ui:Button Icon="{ui:SymbolIcon Home24}"
                           ToolTip="Home"
                           Command="{Binding HomeCommand}"
                           Appearance="Secondary"
                           Margin="2,0"/>
            </StackPanel>

            <!-- Address Bar -->
            <ui:TextBox Grid.Column="1"
                        x:Name="AddressBar"
                        PlaceholderText="Search or enter URL"
                        Icon="{ui:SymbolIcon Search24}"
                        Text="{Binding AddressBarText, UpdateSourceTrigger=PropertyChanged}"
                        Margin="8,4"
                        VerticalAlignment="Center"
                        FontSize="14">
                <ui:TextBox.InputBindings>
                    <KeyBinding Key="Return" Command="{Binding NavigateCommand}"/>
                </ui:TextBox.InputBindings>
            </ui:TextBox>

            <!-- Toolbar Buttons -->
            <StackPanel Grid.Column="2"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        Margin="4,0,8,0">
                <!-- Loading Indicator -->
                <ui:ProgressRing IsIndeterminate="True"
                                 Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"
                                 Width="24"
                                 Height="24"
                                 Margin="4,0"/>

                <!-- Rules Manager -->
                <ui:Button Icon="{ui:SymbolIcon Shield24}"
                           ToolTip="Manage Rules (Ctrl+R)"
                           x:Name="RulesButton"
                           Click="RulesButton_Click"
                           Appearance="Secondary"
                           Margin="4,0"/>

                <!-- Network Monitor Toggle -->
                <ui:Button Icon="{ui:SymbolIcon NetworkCheck24}"
                           ToolTip="Toggle Network Monitor (Ctrl+Shift+N)"
                           Command="{Binding ToggleSidebarCommand}"
                           Appearance="Secondary"
                           Margin="4,0"/>
            </StackPanel>
        </Grid>

        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- WebView2 Browser -->
            <wv2:WebView2 Grid.Column="0"
                          x:Name="webView"
                          Margin="0"/>

            <!-- Sidebar Panel -->
            <Border Grid.Column="1"
                    Width="380"
                    Background="{DynamicResource ApplicationBackgroundBrush}"
                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="1,0,0,0"
                    Visibility="{Binding IsSidebarVisible, Converter={StaticResource BoolToVisibility}}">
                <ContentControl x:Name="SidebarContent"/>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2"
                Background="{DynamicResource ApplicationBackgroundBrush}"
                Padding="8,4">
            <TextBlock Text="Ready"
                       FontSize="12"
                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
        </Border>
    </Grid>
</Window>
